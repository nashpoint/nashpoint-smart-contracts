// SPDX-License-Identifier: BUSL-1.1
pragma solidity 0.8.28;

import {Test, console} from "forge-std/Test.sol";

import {MPTLib} from "src/libraries/MPTLib.sol";

contract MPTLibTest is Test {
    uint256 BLOCK_NUMBER = 382470802;

    function setUp() public {
        vm.createSelectFork(vm.envString("ARBITRUM_RPC_URL"), BLOCK_NUMBER + 16);
        vm.roll(BLOCK_NUMBER + 16);
        vm.setBlockhash(BLOCK_NUMBER, 0x9808a26ec70eb886d1bd0ff0db85cf33705858d7f9f17aa7e90f50793769f209);
    }

    function test_lib() external {
        bytes memory HEADER_RLP =
            hex"f90223a076ca1e97544503fcff9c1754673d0275bc1e1ba25511fb498fcda9bf8d876b48a01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d4934794a4b000000000000000000073657175656e636572a0239e0e58adbeff60d30270a896d3234ce31afedaf43c368025149c9b9d39632ca0c23ff3a0f91862bef8b350088ddce55b4cf63abdb74960a665c16a8bbaa07191a05639d427a47197fead58e3c5402aa97fc25ca4410dc6311a558b292c329e4094b90100000400808800001000200008010001001000080080104000000040104000100400040000008040080000a0000a00000000000021840000488000401030204008001000d40000200021800018400300000040500000140020402000000000024100000000120000000000002026100a010000404020242000000240506010800008000000400000001000000400000080000080000404000400000006004000008222200024200000011000401040000000004001010c0801000002800041110000003482000000810400020080000080000244200008000000088090100a20000010280200000008624008880400204000a1000100100200022225000800000e018416cc0a9287040000000000008327a9f88468d3b6b4a0b99ea41f85341ea9c360dd60a387e691a166a6b96fd821c635745087d57f2419a0000000000002519d0000000001658b0200000000000000280000000000000000880000000000207a3c83989680";

        bytes memory INDEX_RLP = hex"01";

        bytes[] memory PROOF = new bytes[](3);
        PROOF[0] = bytes(
            hex"f871a09ef480b05bb10e0decec9430ab936ede2c4742ba3c837f1b0130597b7cf223fca0739808fa025791258d20a317aa9339733a2ff4c91e3c4f6fe518549533379b1b808080808080a0b0f51de7909653fadedb604e425c3ae1245d466325c8296662c289fa327eeeea8080808080808080"
        );
        PROOF[1] = bytes(
            hex"f901f180a0b4b43cf5631a45dde6f6981af81113b7305ccd9be0517d56ce19a3a5d46d57c1a0b4856f36d02a80b6cba66fb3eacd52e81513386a3516a91cb8f47e92ebda048ea034ff590f426ae317b444698173ba5d0b0e6b308ea48311be6a92a4cfd9e51f50a05b4c2a43b04c767f87d0b06755d988b708ec11563eb52e18e5a0827bc1ed543aa0e1252babc144828f1c962c0b8c0aae3048205017f6cc9e18b03c84e03f8e18c2a04c1eeaf26a7ce7af77fcc26ccd284b5c3f0a726a0f32cff599d8af9197b1884ca0c852f76b1e1cc6253aef1cfd8102db25d6d3d939687c8ea3febcefcbe3143138a089fd192e80f8111a38aaa53971b8b7ab9703ae54cfb32a4041b0e0c107f6e982a02b0df9ac00924484ddb8cd1b54e96197a8a0809c548fdb52343868ccb8fef0e5a0b701d7871ea06e33497f65f0a38a4709e4775ca3507e2428e4bf9099c527f830a09e6e07320ecf8ee56dccdc571854add828d2bb037bc7ce5586fd19c8e23fdc75a08dd810224a0b3df2c7334ee7adce1deb0846a2eee9ce3d67aad167f1ce8ecf7aa0a5768d272664c87adb11f83e3add6c54a44a8d5086dacc1a58018b73d6f73bfea0ced8348e74328f0332615113d22591ec3ba0929f027111f302ef8dd9a5794c74a012dbeeaf64e49dbd997c25c776e366540260a9be460a6297b2901df515d31c0280"
        );
        PROOF[2] = bytes(
            hex"f9030a20b90306f90303018301408db9010000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000001000000000000000000000000000000400000000000000008000000000000000000040000000000000000000000000000020000000000000000000800000000400004000000000010200000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000002002000000000000000000000000000000000008000000000000000020000000000000000000000000000400200000000000000000000200040000000002f901f8f89b94af88d065e77c8cc2239327c5edb3a432268e5831f863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa00000000000000000000000009611c2158af8360f4f8016265ce127b2fc13eceba00000000000000000000000006ca200319a0d4127a7a473d6891b86f34e312f42a000000000000000000000000000000000000000000000000000000000d0ad0540f89b946ca200319a0d4127a7a473d6891b86f34e312f42f863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa00000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000009611c2158af8360f4f8016265ce127b2fc13eceba000000000000000000000000000000000000000000000000000000000cd675468f8bc946ca200319a0d4127a7a473d6891b86f34e312f42f863a0dcbc1c05240f31ff3ad067ef1ee35ce4997762752e3a095284754544f4c709d7a00000000000000000000000009611c2158af8360f4f8016265ce127b2fc13eceba00000000000000000000000009611c2158af8360f4f8016265ce127b2fc13ecebb84000000000000000000000000000000000000000000000000000000000d0ad054000000000000000000000000000000000000000000000000000000000cd675468"
        );

        MPTLib.verifyTransferEvent(BLOCK_NUMBER, HEADER_RLP, INDEX_RLP, PROOF);
    }
}
